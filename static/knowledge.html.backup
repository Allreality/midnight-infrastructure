<!DOCTYPE html>
<html>
<head>
    <title>Midnight Knowledge Base</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            background: #0a0e27; 
            color: #fff; 
            padding: 20px;
            margin: 0;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        .header { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 30px; 
            border-radius: 15px; 
            margin-bottom: 20px; 
        }
        h1 { margin: 0; }
        .search-box {
            background: #1a1f3a;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        input[type="text"] {
            width: 100%;
            padding: 15px;
            font-size: 16px;
            border: 2px solid #667eea;
            border-radius: 8px;
            background: #0a0e27;
            color: #fff;
        }
        .categories {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .category-card {
            background: #1a1f3a;
            padding: 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        .category-card:hover {
            border-color: #667eea;
            transform: translateY(-5px);
        }
        .results {
            background: #1a1f3a;
            padding: 20px;
            border-radius: 10px;
        }
        .result-item {
            background: #0a0e27;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        .stats {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        .stat-card {
            background: #1a1f3a;
            padding: 20px;
            border-radius: 10px;
            flex: 1;
            text-align: center;
        }
        .stat-value {
            font-size: 2em;
            color: #667eea;
            font-weight: bold;
        }
        button {
            padding: 12px 24px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        button:hover { background: #764ba2; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåô Midnight Knowledge Base</h1>
            <p>Blockchain Compliance & Airdrop Intelligence System</p>
        </div>

        <div class="stats">
            <div class="stat-card">
                <div class="stat-value" id="totalDocs">-</div>
                <div>Total Documents</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalSize">-</div>
                <div>Total Size (MB)</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="categoryCount">-</div>
                <div>Categories</div>
            </div>
        </div>

        <div class="search-box">
            <input type="text" id="searchInput" placeholder="Search knowledge base..." onkeypress="handleSearch(event)">
            <button onclick="search()">Search</button>
            <button onclick="loadCategories()">Show Categories</button>
        </div>

        <div id="categories" class="categories"></div>
        <div id="results" class="results" style="display:none;"></div>
    </div>

    <script>
        const API = 'http://localhost:5002/api/knowledge';

        async function loadStats() {
            const res = await fetch(`${API}/stats`);
            const data = await res.json();
            document.getElementById('totalDocs').textContent = data.total_documents;
            document.getElementById('totalSize').textContent = data.total_size_mb;
        }

        async function loadCategories() {
            const res = await fetch(`${API}/categories`);
            const data = await res.json();
            
            document.getElementById('categoryCount').textContent = data.categories.length;
            
            const container = document.getElementById('categories');
            container.innerHTML = data.categories.map(cat => `
                <div class="category-card" onclick="loadCategory('${cat.name}')">
                    <h3>${cat.name}</h3>
                    <p>${cat.document_count} documents</p>
                </div>
            `).join('');
            
            document.getElementById('results').style.display = 'none';
            container.style.display = 'grid';
        }

        async function search() {
            const query = document.getElementById('searchInput').value;
            if (!query) return;

            const res = await fetch(`${API}/search`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({query})
            });
            
            const data = await res.json();
            
            const resultsDiv = document.getElementById('results');
            resultsDiv.style.display = 'block';
            document.getElementById('categories').style.display = 'none';
            
            resultsDiv.innerHTML = `
                <h2>Search Results: ${data.results_count} found</h2>
                ${data.results.map(r => `
                    <div class="result-item">
                        <h3>${r.file}</h3>
                        <p><strong>Category:</strong> ${r.category}</p>
                        <p>${r.preview}</p>
                        <button onclick="viewDocument('${r.path}')">View Full Document</button>
                    </div>
                `).join('')}
            `;
        }

        function handleSearch(e) {
            if (e.key === 'Enter') search();
        }

        async function viewDocument(filepath) {
            const res = await fetch(`${API}/document`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({filepath})
            });
            
            const data = await res.json();
            
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = `
                <button onclick="search()">‚Üê Back to Results</button>
                <h2>${filepath.split('/').pop()}</h2>
                <pre style="white-space: pre-wrap; background: #0a0e27; padding: 20px; border-radius: 8px;">${data.content}</pre>
            `;
        }

        // Load on page load
        loadStats();
        loadCategories();
    </script>
</body>
</html>
