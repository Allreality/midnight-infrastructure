{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///mnt/c/projects/midnight-infrastructure/pages/dashboard.tsx"],"sourcesContent":["// File: pages/dashboard.tsx\n\nimport React from \"react\"\n\ntype HealthResult = {\n  ok: boolean\n  statusCode: number | null\n  body: any | null\n  latencyMs: number | null\n  error?: string\n  checkedAt: string\n}\n\ntype Props = {\n  health: HealthResult\n}\n\nexport async function getServerSideProps() {\n  const FLASK_HEALTH = process.env.FLASK_HEALTH_URL ?? \"http://localhost:5060/health\";\n  const TIMEOUT_MS = 3000;\n  const CACHE_TTL_MS = Number(process.env.HEALTH_CACHE_TTL_MS ?? 5000);\n\n  type HealthResult = {\n    ok: boolean;\n    statusCode: number | null;\n    body: any | null;\n    latencyMs: number | null;\n    error?: string | undefined;\n    checkedAt: string;\n  };\n\n  // Simple in-memory cache (persist across requests in dev & prod per process)\n  // @ts-ignore - attach cache to global to avoid module-scoped reinitialization in dev HMR\n  if (!global.__FLASK_HEALTH_CACHE) {\n    // structure: { value: HealthResult, expiresAt: number }\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore\n    global.__FLASK_HEALTH_CACHE = { value: null, expiresAt: 0 };\n  }\n  // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n  // @ts-ignore\n  const cache = global.__FLASK_HEALTH_CACHE;\n\n  const now = Date.now();\n  if (cache.value && cache.expiresAt > now) {\n    return { props: { health: cache.value } };\n  }\n\n  const start = Date.now();\n  let health: HealthResult = {\n    ok: false,\n    statusCode: null,\n    body: null,\n    latencyMs: null,\n    error: undefined,\n    checkedAt: new Date().toISOString(),\n  };\n\n  try {\n    const controller = new AbortController();\n    const timeout = setTimeout(() => controller.abort(), TIMEOUT_MS);\n\n    const res = await fetch(FLASK_HEALTH, { signal: controller.signal });\n    clearTimeout(timeout);\n\n    const latencyMs = Date.now() - start;\n    let parsedBody = null;\n    try {\n      parsedBody = await res.json();\n    } catch {\n      try {\n        parsedBody = await res.text();\n      } catch {\n        parsedBody = null;\n      }\n    }\n\n    health = {\n      ok: res.ok,\n      statusCode: res.status,\n      body: parsedBody,\n      latencyMs,\n      checkedAt: new Date().toISOString(),\n    };\n  } catch (err: any) {\n    const latencyMs = Date.now() - start;\n    health = {\n      ok: false,\n      statusCode: null,\n      body: null,\n      latencyMs,\n      error: err?.message ?? String(err),\n      checkedAt: new Date().toISOString(),\n    };\n  }\n\n  // store in cache\n  cache.value = health;\n  cache.expiresAt = Date.now() + CACHE_TTL_MS;\n\n  return { props: { health } };\n}"],"names":[],"mappings":"AAAA,4BAA4B;;;;;AAiBrB,eAAe;IACpB,MAAM,eAAe,QAAQ,GAAG,CAAC,gBAAgB,IAAI;IACrD,MAAM,aAAa;IACnB,MAAM,eAAe,OAAO,QAAQ,GAAG,CAAC,mBAAmB,IAAI;IAW/D,6EAA6E;IAC7E,yFAAyF;IACzF,IAAI,CAAC,yDAAO,oBAAoB,EAAE;QAChC,wDAAwD;QACxD,6DAA6D;QAC7D,aAAa;QACb,yDAAO,oBAAoB,GAAG;YAAE,OAAO;YAAM,WAAW;QAAE;IAC5D;IACA,6DAA6D;IAC7D,aAAa;IACb,MAAM,QAAQ,yDAAO,oBAAoB;IAEzC,MAAM,MAAM,KAAK,GAAG;IACpB,IAAI,MAAM,KAAK,IAAI,MAAM,SAAS,GAAG,KAAK;QACxC,OAAO;YAAE,OAAO;gBAAE,QAAQ,MAAM,KAAK;YAAC;QAAE;IAC1C;IAEA,MAAM,QAAQ,KAAK,GAAG;IACtB,IAAI,SAAuB;QACzB,IAAI;QACJ,YAAY;QACZ,MAAM;QACN,WAAW;QACX,OAAO;QACP,WAAW,IAAI,OAAO,WAAW;IACnC;IAEA,IAAI;QACF,MAAM,aAAa,IAAI;QACvB,MAAM,UAAU,WAAW,IAAM,WAAW,KAAK,IAAI;QAErD,MAAM,MAAM,MAAM,MAAM,cAAc;YAAE,QAAQ,WAAW,MAAM;QAAC;QAClE,aAAa;QAEb,MAAM,YAAY,KAAK,GAAG,KAAK;QAC/B,IAAI,aAAa;QACjB,IAAI;YACF,aAAa,MAAM,IAAI,IAAI;QAC7B,EAAE,OAAM;YACN,IAAI;gBACF,aAAa,MAAM,IAAI,IAAI;YAC7B,EAAE,OAAM;gBACN,aAAa;YACf;QACF;QAEA,SAAS;YACP,IAAI,IAAI,EAAE;YACV,YAAY,IAAI,MAAM;YACtB,MAAM;YACN;YACA,WAAW,IAAI,OAAO,WAAW;QACnC;IACF,EAAE,OAAO,KAAU;QACjB,MAAM,YAAY,KAAK,GAAG,KAAK;QAC/B,SAAS;YACP,IAAI;YACJ,YAAY;YACZ,MAAM;YACN;YACA,OAAO,KAAK,WAAW,OAAO;YAC9B,WAAW,IAAI,OAAO,WAAW;QACnC;IACF;IAEA,iBAAiB;IACjB,MAAM,KAAK,GAAG;IACd,MAAM,SAAS,GAAG,KAAK,GAAG,KAAK;IAE/B,OAAO;QAAE,OAAO;YAAE;QAAO;IAAE;AAC7B","debugId":null}}]
}