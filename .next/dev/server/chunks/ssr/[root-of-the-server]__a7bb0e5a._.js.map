{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///mnt/c/projects/midnight-infrastructure/pages/dashboard.tsx"],"sourcesContent":["// File: pages/dashboard.tsx\nimport React from \"react\";\n\ntype HealthResult = {\n  ok: boolean;\n  statusCode: number | null;\n  body: any | null;\n  latencyMs: number | null;\n  error?: string | null;\n  checkedAt: string;\n};\n\ntype Props = {\n  health: HealthResult;\n};\n\nexport default function Dashboard({ health }: Props) {\n  return (\n    <main style={{ fontFamily: \"system-ui, sans-serif\", padding: 24 }}>\n      <h1>Dashboard</h1>\n\n      <section style={{ marginTop: 20 }}>\n        <h2>Flask Health Check</h2>\n\n        <div\n          style={{\n            display: \"grid\",\n            gridTemplateColumns: \"140px 1fr\",\n            gap: 8,\n            alignItems: \"start\",\n            maxWidth: 720,\n            background: \"#f7f7f8\",\n            padding: 12,\n            borderRadius: 8,\n          }}\n        >\n          <strong>Status</strong>\n          <div>\n            <span\n              style={{\n                display: \"inline-block\",\n                width: 10,\n                height: 10,\n                borderRadius: 10,\n                marginRight: 8,\n                background: health?.ok ? \"#16a34a\" : \"#dc2626\",\n                verticalAlign: \"middle\",\n              }}\n            />\n            <span style={{ fontWeight: 600 }}>\n              {health?.ok ? \"Healthy\" : \"Unhealthy\"}\n            </span>\n          </div>\n\n          <strong>HTTP</strong>\n          <div>{health?.statusCode ?? \"—\"}</div>\n\n          <strong>Latency</strong>\n          <div>{health?.latencyMs !== null ? `${health.latencyMs} ms` : \"—\"}</div>\n\n          <strong>Response</strong>\n          <div style={{ whiteSpace: \"pre-wrap\", fontFamily: \"monospace\", fontSize: 13 }}>\n            {health?.body ? JSON.stringify(health.body, null, 2) : \"No body\"}\n          </div>\n\n          <strong>Checked At</strong>\n          <div>{health?.checkedAt ?? \"—\"}</div>\n\n          <strong>Error</strong>\n          <div style={{ color: \"#b91c1c\" }}>{health?.error ?? \"None\"}</div>\n        </div>\n      </section>\n    </main>\n  );\n}\n\nexport async function getServerSideProps() {\n  const FLASK_HEALTH = process.env.FLASK_HEALTH_URL ?? \"http://localhost:5060/health\";\n  const TIMEOUT_MS = 3000;\n  const CACHE_TTL_MS = Number(process.env.HEALTH_CACHE_TTL_MS ?? 5000);\n\n  // Simple HealthResult local type (kept here for clarity)\n  type LocalHealth = {\n    ok: boolean;\n    statusCode: number | null;\n    body: any | null;\n    latencyMs: number | null;\n    error?: string | null;\n    checkedAt: string;\n  };\n\n  // Attach a simple in-memory cache to global to survive HMR in dev\n  // @ts-ignore\n  if (!global.__FLASK_HEALTH_CACHE) {\n    // structure: { value: LocalHealth | null, expiresAt: number }\n    // @ts-ignore\n    global.__FLASK_HEALTH_CACHE = { value: null, expiresAt: 0 };\n  }\n  // @ts-ignore\n  const cache: { value: LocalHealth | null; expiresAt: number } = global.__FLASK_HEALTH_CACHE;\n\n  const now = Date.now();\n  if (cache.value && cache.expiresAt > now) {\n    return { props: { health: cache.value } };\n  }\n\n  const start = Date.now();\n  let health: LocalHealth = {\n    ok: false,\n    statusCode: null,\n    body: null,\n    latencyMs: null,\n    error: null,\n    checkedAt: new Date().toISOString(),\n  };\n\n  try {\n    const controller = new AbortController();\n    const timeout = setTimeout(() => controller.abort(), TIMEOUT_MS);\n\n    const res = await fetch(FLASK_HEALTH, { signal: controller.signal });\n    clearTimeout(timeout);\n\n    const latencyMs = Date.now() - start;\n    let parsedBody: any = null;\n    try {\n      parsedBody = await res.json();\n    } catch {\n      try {\n        parsedBody = await res.text();\n      } catch {\n        parsedBody = null;\n      }\n    }\n\n    health = {\n      ok: res.ok,\n      statusCode: res.status,\n      body: parsedBody,\n      latencyMs,\n      checkedAt: new Date().toISOString(),\n    };\n  } catch (err: any) {\n    const latencyMs = Date.now() - start;\n    health = {\n      ok: false,\n      statusCode: null,\n      body: null,\n      latencyMs,\n      error: err?.message ?? String(err),\n      checkedAt: new Date().toISOString(),\n    };\n  }\n\n  // store in cache\n  cache.value = health;\n  cache.expiresAt = Date.now() + CACHE_TTL_MS;\n\n  return { props: { health } };\n}"],"names":[],"mappings":"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","debugId":null}}]
}